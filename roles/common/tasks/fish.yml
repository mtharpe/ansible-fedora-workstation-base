---
- name: Install fish
  ansible.builtin.dnf:
  become: true

- name: Create fish config directory
  ansible.builtin.file:
    path: /home/{{ local_user }}/.config/fish
    owner: "{{ local_user }}"
    group: wheel
    mode: "0755"

- name: Template fish config
  ansible.builtin.copy:
    src: templates/config.fish
    owner: "{{ local_user }}"
    group: wheel
    mode: "0644"

- name: Template tmux.conf
  ansible.builtin.copy:
    src: templates/tmux.conf
    owner: "{{ local_user }}"
    group: "{{ local_user }}"
    mode: "0644"

- name: Install Tmux TPM
  ansible.builtin.git:
    repo: https://github.com/tmux-plugins/tpm
    version: master

- name: Download Starship install script
  ansible.builtin.get_url:
    url: https://starship.rs/install.sh
    dest: /tmp/starship_install.sh
    mode: "0755"

- name: Install Starship fish prompt
  ansible.builtin.shell: sh /tmp/starship_install.sh --yes

- name: Template starship config
  ansible.builtin.copy:
    dest: /home/{{ local_user }}/.config/starship.toml
    owner: "{{ local_user }}"
    group: wheel
    mode: "0644"

- name: Copy fish aliases script
  ansible.builtin.copy:
    dest: /home/{{ local_user }}/fish_aliases.sh
    owner: "{{ local_user }}"
    group: wheel
    mode: "0755"

- name: Execute fish aliases script
  ansible.builtin.shell: /home/{{ local_user }}/fish_aliases.sh
  become: true
  become_user: "{{ local_user }}"
  args:
    executable: /usr/bin/fish
