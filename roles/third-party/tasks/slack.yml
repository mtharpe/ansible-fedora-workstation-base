---
- name: Get latest Slack RPM URL
  ansible.builtin.uri:
    url: https://slack.com/downloads/instructions/linux
    return_content: true
  register: slack_download_page
  tags: [third_party, slack]

- name: Extract Slack RPM URL
  ansible.builtin.set_fact:
    slack_latest_rpm_url: "{{ slack_download_page.content | regex_search('https://downloads.slack-edge.com/desktop-releases/linux/x64/[^\\\\\"]+\\\\.rpm') }}"
  tags: [third_party, slack]

- name: Download latest Slack RPM
  ansible.builtin.get_url:
    url: "{{ slack_latest_rpm_url }}"
    dest: /tmp/slack-latest.rpm
    mode: '0644'
  tags: [third_party, slack]

- name: Install Slack (latest RPM)
  ansible.builtin.dnf:
    name: /tmp/slack-latest.rpm
    disable_gpg_check: true
    state: present
  become: true
  tags: [third_party, slack]
